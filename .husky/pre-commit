#!/usr/bin/env sh

# Run unit tests first
echo "ğŸ§ª Running unit tests..."
if ! bun test; then
  echo "âŒ Unit tests failed. Please fix the errors above."
  exit 1
fi
echo "âœ… Unit tests passed!"

# Update coverage badge in README
echo "ğŸ“Š Updating coverage badge..."
node scripts/update-coverage-badge.mjs
if [ -f README.md ]; then
  git add README.md
fi

# Run lint-staged with better error handling
echo "ğŸ” Running pre-commit checks..."
if ! bunx lint-staged; then
  echo "âŒ Pre-commit checks failed. Please fix the errors above."
  exit 1
fi

echo "âœ… Pre-commit checks passed!"
