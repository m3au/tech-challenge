#!/usr/bin/env sh
# shellcheck disable=SC1091
. "$(dirname -- "$0")/_/husky.sh"

# Prevent infinite loop: skip if this is an amend
if [ -f ".git/AMEND_IN_PROGRESS" ]; then
  rm ".git/AMEND_IN_PROGRESS"
  exit 0
fi

# Check if package.json or CHANGELOG.md are staged (from prepare-commit-msg)
if git diff --cached --name-only | grep -qE '^(package\.json|CHANGELOG\.md)$'; then
  echo "ðŸ“¦ Including version and changelog in commit..."
  touch ".git/AMEND_IN_PROGRESS"
  git commit --amend --no-edit --no-verify
  rm -f ".git/AMEND_IN_PROGRESS"
fi

